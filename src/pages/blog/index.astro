---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const posts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Group posts by year
const postsByYear = posts.reduce((acc, post) => {
  const year = post.data.date.getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(post);
  return acc;
}, {} as Record<number, typeof posts>);

const years = Object.keys(postsByYear).sort((a, b) => Number(b) - Number(a));
---

<BaseLayout 
  title="Blog | Rishav Katoch" 
  description="Thoughts on technology, programming, and building things."
>
  <div class="container">
    <header class="page-header fade-in">
      <h1 class="page-title">Blog</h1>
      <p class="page-description">
        Thoughts on technology, programming, and building things.
      </p>
    </header>
    
    {posts.length > 0 ? (
      <div class="posts-container fade-in stagger-2">
        {years.map((year) => (
          <section class="year-section">
            <h2 class="year-heading">{year}</h2>
            <ul class="posts-list">
              {postsByYear[Number(year)].map((post) => (
                <li>
                  <a href={`/blog/${post.slug}`} class="post-item">
                    <div class="post-content">
                      <h3 class="post-title">{post.data.title}</h3>
                      <p class="post-description">{post.data.description}</p>
                    </div>
                    <time class="post-date" datetime={post.data.date.toISOString()}>
                      {new Date(post.data.date).toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric'
                      })}
                    </time>
                  </a>
                </li>
              ))}
            </ul>
          </section>
        ))}
      </div>
    ) : (
      <div class="empty-state fade-in stagger-2">
        <p>No posts yet. Check back soon!</p>
      </div>
    )}
  </div>
</BaseLayout>

<style>
  .page-header {
    margin-bottom: var(--space-3xl);
  }
  
  .page-title {
    font-size: var(--text-3xl);
    font-weight: 700;
    margin-bottom: var(--space-sm);
  }
  
  .page-description {
    color: var(--color-text-muted);
    font-size: var(--text-lg);
    margin: 0;
  }
  
  .posts-container {
    display: flex;
    flex-direction: column;
    gap: var(--space-2xl);
  }
  
  .year-section {
    display: flex;
    flex-direction: column;
  }
  
  .year-heading {
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text-muted);
    margin: 0 0 var(--space-md) 0;
    padding-bottom: var(--space-sm);
    border-bottom: 1px solid var(--color-border);
  }
  
  .posts-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
  }
  
  .post-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: var(--space-lg);
    padding: var(--space-md) var(--space-lg);
    margin: 0 calc(-1 * var(--space-lg));
    text-decoration: none;
    border-radius: var(--radius-md);
    transition: background-color var(--transition-fast);
  }
  
  .post-item:hover {
    background-color: var(--color-bg-alt);
  }
  
  .post-content {
    flex: 1;
    min-width: 0;
  }
  
  .post-title {
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--color-text);
    margin: 0 0 var(--space-xs) 0;
    transition: color var(--transition-fast);
  }
  
  .post-item:hover .post-title {
    color: var(--color-accent);
  }
  
  .post-description {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    margin: 0;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .post-date {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-text-faint);
    white-space: nowrap;
    flex-shrink: 0;
  }
  
  .empty-state {
    text-align: center;
    padding: var(--space-3xl) 0;
  }
  
  .empty-state p {
    color: var(--color-text-muted);
    font-style: italic;
  }
  
  @media (max-width: 640px) {
    .post-item {
      flex-direction: column;
      gap: var(--space-xs);
    }
    
    .post-date {
      order: -1;
    }
  }
</style>

